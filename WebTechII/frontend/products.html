<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<style>
body{
  font-size: 1.4rem;
}

nav {
    background-color: rgb(113, 158, 158) ;
    width: 100%;
    height: 60px;
     
        };

.card-img-top {
    min-width: 100%;
    width: auto;
    height: auto;
}

</style>

</head>
<body>
<!--Navbar-->
<nav class="navbar navbar-expand-lg navbar-dark primary-color">

    <!-- Navbar brand -->
    <a class="navbar-brand" href="homepage.html">Gagdet Shop <i class="glyphicon glyphicon-headphones"></i>
    </a>
  
    <!-- Collapse button -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav"
      aria-controls="basicExampleNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="basicExampleNav">
  
      <!-- Links -->
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="homepage.html">Home
            <span class="sr-only">(current)</span>
            <i class="glyphicon glyphicon-home"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">MyOrders <i class="glyphicon glyphicon-folder-open"></i></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">AboutUs <i class="glyphicon glyphicon-info-sign"></i>
          </a>
        </li>
        <li class="nav-item" style="margin-left:250px;">
            <a class="nav-link" href="#" id="username">Hi, <i class="glyphicon glyphicon-user"></i>
            </a>
          </li>
        <!-- Dropdown -->
        
        <li class="nav-item" style="margin-left:10px;">
          <a class="nav-link" href="#" id="Logout" onclick="loggingout()"><span class="glyphicon glyphicon-log-out">Logout</span>
          </a>
          
  </li>
      

  <li class="nav-item" style="margin-left:150px;margin-top:10px ;">
          <button type="button" class="btn btn-primary" onclick="loadcartpage()" style="height:35px;background-color: green;width: 110%;font-size:15px;">
                  Cart <span class="badge badge-light" id="noofprods">4</span>
           </button>
  </li>
      </ul>
      <!-- Links -->
  
      
    </div>
    <!-- Collapsible content -->
  
  </nav>
  <!--/.Navbar-->
<!--<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="card h-100">
        <a href="#"><img class="card-img-top" src="" alt=""></a>
              <div class="card-body">
                <h4 class="card-title">
                  <a href="#">Item Five</a>
                </h4>
                <h5>$24.99</h5>
                <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Amet numquam aspernatur! Lorem ipsum dolor sit amet.</p>
              </div>
              <div class="card-footer">
                <small class="text-muted">&#9733; &#9733; &#9733; &#9733; &#9734;</small>
              </div>
    </div>
</div>
-->

<img src="img/1.jpeg" id ="imsr" style="display: none;"> 
<br>

<h1 style="font-weight:5000;color:rgb(92, 89, 89);margin-left: 20px;"> Mobiles</h1>
<br>
<!--<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="card h-100">
        <a href="#"><img class="card-img-top" src="i.jpeg" alt="" style="width:65%;height:300px;display:block;margin-left:auto;margin-right:auto;"> </a>
              <div class="card-body">
                <h4 class="card-title">
                  <a href="#">Item Five</a>
                </h4>
                <h5>$24.99</h5>
                <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Amet numquam aspernatur! Lorem ipsum dolor sit amet.</p>
              </div>
              <div class="card-footer">
                <small class="text-muted">&#9733; &#9733; &#9733; &#9733; &#9734;</small>
              </div>
    </div>
</div>
-->










</body>
<script>

function createimage(imdata,prodname,priceele,descriptionele,prodidel,codep){

var body=document.getElementsByTagName("body")[0];
//console.log("hello")
var outter= document.createElement("div");
outter.className="col-lg-4 col-md-6 col-sm-6 col-xs-12";
var inner =document.createElement("div");
inner.className="card h-100";
outter.appendChild(inner);
var prodid =document.createElement("h4");
prodid.innerHTML=prodidel;
prodid.style="display:none";
outter.appendChild(prodid);
var a = document.createElement("a");
var image= document.createElement("img");
image.className="card-img-top";
image.src=imdata;
if(localStorage.getItem("category")=="laptop" || localStorage.getItem("category")=="tv" ||codep==3 ||codep==2 || codep==1){
image.style="width:75%;height:250px;display:block;margin-left:auto;margin-right:auto";}
else if(localStorage.getItem("category")=="watch" || localStorage.getItem("category")=="acc" || localStorage.getItem("category")=="headphone") {
image.style="width:43%;height:300px;display:block;margin-left:auto;margin-right:auto";}
else if(localStorage.getItem("category")=="mobile"){
image.style="width:37%;height:300px;display:block;margin-left:auto;margin-right:auto";}
else if(codep==1){
image.style="width:40%;height:250px;display:block;margin-left:auto;margin-right:auto";}


image.alt="image was here";
inner.appendChild(image);
var inner1= document.createElement("div");
inner1.className="card-body";
var inner1title =document.createElement("h4");
inner1title.className="card-title";
var inner1titlelink = document.createElement("a");
inner1titlelink.href="product.html";
inner1titlelink.onclick=loadprod;
inner1titlelink.innerHTML=prodname;
inner1title.appendChild(inner1titlelink);
inner1.appendChild(inner1title);
var price =document.createElement("h5");
price.innerHTML=priceele;
var description = document.createElement("p");
description.className="card-text";
description.innerHTML=descriptionele;
inner1.appendChild(price);
inner1.appendChild(description);
inner.appendChild(inner1);
var inner2 = document.createElement("div");
inner2.className="card-footer";
var rating = document.createElement("small");
rating.className="text-muted";
rating.innerHTML="&#9733; &#9733; &#9733; &#9733; &#9734;";
inner2.appendChild(rating);
inner.appendChild(inner2);

body.appendChild(outter);
          }


var imdata=document.getElementById("imsr").src;
var prodname="Product name Product name Product name";
var amount="";
var price= "₹"+amount;
var description="Lorem ipsum dolor sit amet, consectetur adipisicing elit. Amet numquam aspernatur! Lorem ipsum dolor sit amet.";
var productid=1; 


xhr=new XMLHttpRequest();
scrollAmt=3000;
count=0;
var i=0;
var cat=localStorage.getItem("category");
var countprods=1;
function getChunk(){
  scroll=document.body.scrollTop||document.documentElement.scrollTop;
  scroll=scroll-scrollAmt*1;
 // console.log("scroll"+scroll);
  if(scroll>scrollAmt){
	  scrollAmt=scroll;
	  xhr.onreadystatechange=showChunk;
	  xhr.open("GET","http://localhost:5000/product/"+cat+"/"+countprods,true);
	  xhr.send();
			}
    scrollAmt=scroll;
	}
function showChunk(){
	//console.log(xhr.status)
	if(xhr.readyState==4 && xhr.status==200){
		//console.log("hello");
		//console.log(xhr.responseText);
    //genimages(xhr.responseText);
    var res=JSON.parse(xhr.responseText);
    var size =Object.keys(res).length;
    if(size==0)
    {
      xhr.abort();
    }
    else{
    //console.log(size);
    imdata="img/"+res["photo"];
    prodname=res["name"];
    amount="₹"+res["price"];
    productid=res["id"];
    console.log(res)
    createimage(imdata,prodname,amount,description,productid);
    countprods=countprods+1;
    }
	}
				
			
  }
window.onscroll=getChunk;


createimage("img/18.jpeg","Noise Color watch ","₹ 39,999",description,18,1)

createimage("img/35.jpeg","JBL 5W mini speakers","₹ 4,599",description,35,2)
createimage("img/17.jpeg","Panasonic 45inch TV","₹ 39,999",description,17,3)
createimage("img/6.jpeg","Apple airpods 1","₹ 12,799",description,6,4)
createimage("img/8.jpeg","Samsung S9 4GB 64GB","₹ 45499",description,8,5)

    
    
function setcat()
{
    if(xhr.readyState==4 && xhr.status==200)
    {
        //console.log(JSON.parse(xhr.responseText));
        //console.log("recieved")
        var res= JSON.parse(xhr.responseText);
        //document.getElementById("productname").innerHTML=res["name"];
        var a=res["category"];
        localStorage.setItem("category",a);
        
    }
    
}


function loadprod(){
  var parent = this.parentNode.parentNode.parentNode.parentNode;
  var prodid=parent.childNodes[1].innerHTML;
  //console.log(parent);
  console.log(prodid);
  localStorage.setItem("productid",prodid);
  xhr =new XMLHttpRequest;
  xhr.onreadystatechange=setcat;
  var url="http://localhost:5000/product/"+prodid;
  xhr.open("GET",url,true);
  xhr.send();
  // set the category local stoage varible here
}

cartitems=JSON.parse(localStorage.getItem("cart"));
var len=Object.keys(cartitems).length;
console.log(cartitems)
document.getElementById("noofprods").innerHTML=len;
var username=document.getElementById("username")
username.innerHTML+=localStorage.getItem("presentuser");




function loggingout(){
  console.log("will log you out");
  localStorage.removeItem("presentuser");
  location.replace("index.html");
}

function loadcartpage(){
  window.location.replace("cart.html")
}
</script>
</html>